<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-178666696-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-178666696-1');</script><meta name=generator content="Hugo 0.71.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=author content="Michele SciabarrÃ "><meta name=keywords content="Advocate"><meta name=description content="Want to see a serverless action playing chess running on multiple public clouds from multiple vendors, such as Adobe IO Runtime, IBM Cloud, Naver, and Nimbella? Read on..."><meta property="og:title" content="Apache OpenWhisk is a truly portable Serverless Platform"><meta property="og:description" content="Want to see a serverless action playing chess running on multiple public clouds from multiple vendors, such as Adobe IO Runtime, IBM Cloud, Naver, and Nimbella? Read on..."><meta property="og:type" content="article"><meta property="og:url" content="https://openwhisk.blog/post/advocate/openwhisk-portable-serverless/"><meta property="article:published_time" content="2020-09-18T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-18T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Apache OpenWhisk is a truly portable Serverless Platform"><meta name=twitter:description content="Want to see a serverless action playing chess running on multiple public clouds from multiple vendors, such as Adobe IO Runtime, IBM Cloud, Naver, and Nimbella? Read on..."><link rel=stylesheet type=text/css media=screen href=https://openwhisk.blog/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://openwhisk.blog/css/main.css><link rel=stylesheet type=text/css media=screen href=https://openwhisk.blog/css/all.css><link rel=stylesheet href=https://openwhisk.blog/css/katex.min.css crossorigin=anonymous><script defer src=https://openwhisk.blog/js/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://openwhisk.blog/js/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body);></script><link rel=stylesheet type=text/css media=screen href=https://openwhisk.blog/css/custom.css><title>Apache OpenWhisk is a truly portable Serverless Platform | OpenWhisk and friends</title></head><body><header><div id=avatar><a href=https://openwhisk.blog/><img src=/img/pagurus-cartoon.png alt="OpenWhisk and friends"></a></div><div id=titletext><h2 id=title><a href=https://openwhisk.blog/>OpenWhisk and friends</a></h2></div><div id=title-description><p id=subtitle><a href=https://linkedin.com/in/msciab>Michele Sciabarra</a> blog advocating <a href=http://openwhisk.apache.org/>Apache OpenWhisk</a>.</p><div id=social><nav><ul><li><a href=https://github.com/openwhisk-blog><i title=Github class="icons fab fa-github"></i></a></li><li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/post>All Posts</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>18</span>
<span class=rest>Sep 2020</span></div></div><div class=matter><h1 class=title>Apache OpenWhisk is a truly portable Serverless Platform</h1></div></div><div class=markdown><h1 id=tldr>TL;DR</h1><p>Apache OpenWhisk is a truly portable and multiplatform Serverless engine and it is available now on all the major clouds from multiple commercial vendors. Here is a Chess Engine running on:</p><ul><li><a href=https://whisk-chess.adobeioruntime.net/api/v1/web/default/chess>Adobe IO</a></li><li><a href=https://eu-de.functions.appdomain.cloud/api/v1/web/a1d40f6b-e5e3-4f07-8f92-77b525392253/default/chess>IBM Cloud</a></li><li><a href=https://wka9bi13u3.apigw.ntruss.com/chess/chess/ZC2o7bFh0x/http>Naver</a></li><li><a href=https://apigcp.nimbella.io/api/v1/web/msciabar-zc3thebgxgh/default/chess>Nimbella</a></li></ul><p>And see below for instructions how to run it also locally and in any Kubernetes cluster, for example AWS EKS&mldr;</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/02Xezhf_j4U style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h1 id=openwhisk>OpenWhisk?</h1><p>Apache OpenWhisk is a Serverless Cloud Platform, developed as an open source project at the Apache Software Foundations. It is similar to Amazon Lambda, Google Functions or Azure Functions. The main difference is that it is an Open Source project, it is offered by multiple commercial vendors, and it has a rich serverless programing model for composing functions into workflows.</p><p>Many vendors today offer cloud functions based on OpenWhisk, and it runs on all the major public clouds. However not all the vendors disclose where they run their services, so I will refer to the vendor and not to the cloud that runs it. It can also be installed on any Kubernetes cluster, so you can install in any cloud, either your private cloud or the public one you prefer.</p><p>In this article I am going to show that OpenWhisk is a truly portable serverless solution, and that you can write a single serverless application and then run it on multiple vendors.</p><p>To prove my point, I wrote an open source serverless application and ran it on all the OpenWhisk vendors I got access to. I also created a custom Kubernetes cluster and installed OpenWhisk on it to run my application.</p><p>The application is a chess engine, written in the Go programming language, and that includes backend and frontend. You can use it to play chess using a web interface, while the opponent is an AI algorithm running as a serverless function in OpenWhisk.</p><h1 id=local-deploy>Local Deploy</h1><p>For testing and development you can use the Standalone OpenWhisk. It is a single node installation that can run in your machine and only requires <a href=https://docker.com><code>Docker</code></a> to run. You also need to download the <a href=https://github.com/apache/openwhisk-cli/releases/tag/1.0.0>OpenWhisk CLI tool <code>wsk</code></a> for your operating system in order to interact with OpenWhisk.</p><p>Once prerequisites are satisfied, you can start a local OpenWhisk with the following command:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>bash &lt;(curl -sL https://s.apache.org/openwhisk.sh)
</code></pre></div><p>The command will download a Docker image for standalone OpenWhisk and it will start it. It will also open the playground, that you can use to create and run a function on the fly from your browser.</p><p><img src=playground-ui.png alt=Playground></p><p>Once you have OpenWhisk up and running you can configure the <code>wsk</code> tool to access it. OpenWhisk access is protected by a key that you have to retrieve and use to configure <code>wsk</code>, as follows:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>AUTH=$(docker exec openwhisk wsk property get --auth | awk &#39;{ print $3}&#39;)
wsk property set --auth $AUTH --apihost http://localhost:3233
</code></pre></div><h1 id=building-and-testing-our-chess-action>Building and testing our Chess Action</h1><p>Now let&rsquo;s build our chess engine and use the local OpenWhisk to test it locally. The source code of the chess engine <a href=https://github.com/openwhisk-blog/whisk-chess>is available on GitHub</a>.</p><p>The code is based on a freely available chess engine called <a href=https://github.com/ChizhovVadim/CounterGo/pulls>CounterGo</a>. It is written in Go. I adapted it to run as a stateless serverless action, and I added a frontend in JavaScript, using the libraries <a href=https://chessboardjs.com>Chessboardjs</a> and <a href=https://github.com/jhlywa/chess.js>chess.js</a>.</p><p>In order to build the action, you need common tools like <code>git</code>, <code>make</code> and <code>docker</code>. Once you have them you can download and build the sources with the commands:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>git clone https://github.com/openwhisk-blog/whisk-chess
cd whisk-chess
make
</code></pre></div><p>Note that you do not need a Go compiler to build the action, just Docker, as you can compile the action using the OpenWhisk Go runtime itself. The result is the file <code>chess.zip</code> containing a pre-compiled Go action ready to be deployed.</p><p>Once you have the action, you use the following command to deploy it in OpenWhisk:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>wsk action update chess chess.zip --kind go:1.11 --web true
</code></pre></div><p>Finally you can retrieve the URL of the action with the command:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>wsk action get chess --url
</code></pre></div><p>If you now type the URL in a browser you will see the user interface of our chess engine, a chessboard, and you can play chess against the computer.</p><p><img src=chess.png alt=Chess></p><h1 id=nimbella>Nimbella</h1><p>Now let&rsquo;s start deploying our chess in the services of the various vendors that offer OpenWhisk.</p><p><a href=https://nimbella.com>Nimbella</a> offers a serverless solution based on OpenWhisk and focused on providing an &ldquo;awesome developer experience&rdquo;.</p><p>I think it is appropriate to say that I work for Nimbella, but I am trying to be neutral in this article and offer a fair comparison of all the OpenWhisk vendors I am aware of.</p><p><img src=020.png alt=Nimbella></p><p>Nimbella uses its own CLI called <code>nim</code> for deployment. The Nimbella CLI was recently <a href=https://github.com/nimbella/nimbella-cli/>open sourced</a>. You need to sign-up and login to use their service. Once you are logged in, you can deploy our chess action and get an URL for it. The <code>nim login</code> command conveniently permits sign-up.
The CLI is available <a href=https://nimbella.io/downloads/nim/nim.html#install-the-nimbella-command-line-tool-nim>for download</a> for Mac OS, Windows and Linux.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>nim login
nim action update chess chess.zip --kind go:1.12 --web true
nim action get chess --url
</code></pre></div><p>It is possible to use the <code>wsk</code> CLI with Nimbella if one prefers it. You&rsquo;ll notice the command is identical here to the one shown earlier but replaced <code>wsk</code> with <code>nim</code>.</p><p><a href=https://apigcp.nimbella.io/api/v1/web/msciabar-zc3thebgxgh/default/chess>Follow this link to play chess on Nimbella</a>.</p><h1 id=ibm-cloud>IBM Cloud</h1><p>The IBM cloud was the original cloud offering OpenWhisk as a service.</p><p><img src=030.png alt=IBM></p><p>You need to download and install the <code>ibmcloud</code> CLI in order to deploy actions to IBM. There are also some requirements like downloading a plugin and to target a space; all the steps are explained on their website.</p><p>They offer a generous free tier for running functions. You need to register on their website to use a very large number of function invocations for free.</p><p>Once you downloaded the tool, the commands to deploy the chess engine and get an URL to run the action are:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>ibmcloud login -u &#34;$IBMUSER&#34; -p &#34;$IBMPASS&#34;
ibmcloud fn action update chess chess.zip --kind go:1.11
ibmcloud fn action get chess --url
</code></pre></div><p><a href=https://eu-de.functions.appdomain.cloud/api/v1/web/a1d40f6b-e5e3-4f07-8f92-77b525392253/default/chess>Follow this link to play Chess on IBM Cloud.</a></p><h1 id=naver>Naver</h1><p>Naver is a Korean company, owner of the main search engine in the Korean language, but also offering cloud services. The Naver Cloud Platform uses OpenWhisk to implement cloud functions.</p><p><img src=040.png alt=Naver></p><p>Currently Naver does not offer a CLI to deploy actions, however I was told a CLI is actually under development. For now I deployed the chess action using their web interface.</p><p><img src=041.png alt="Naver Deploy"></p><p><a href=https://wka9bi13u3.apigw.ntruss.com/chess/chess/ZC2o7bFh0x/http>Follow this link to play Chess on Naver.</a></p><h1 id=adobe-io>Adobe I/O</h1><p>Adobe has a serverless offering based on OpenWhisk too. It is called the <a href=https://www.adobe.io/apis/experienceplatform/runtime.html>Adobe I/O Runtime</a>.</p><p><img src=045.png alt="Adobe I/O"></p><p>Adobe I/O Runtime currently supports only Node.js based runtimes, so if you pick them as your serverless function providers you have to write your serverless functions in JavaScript. However being based on OpenWhisk, it is possible to use other runtimes by request, and so we can also run our chess engine. I thank the team at Adobe for their kind support and help in deploying my action for demonstration purposes.</p><p><a href=https://whisk-chess.adobeioruntime.net/api/v1/web/default/chess>Follow this link to play Chess on Adobe I/O.</a></p><h1 id=custom-on-aws>Custom on AWS</h1><p>Finally, you can run OpenWhisk in any cluster supporting Kubernetes. For this purpose, I created an EKS cluster on AWS and installed OpenWhisk on it, then I deployed my chess application. I will show here how to do that quickly and easily.</p><p><img src=053.png alt=AWS></p><p>You will need to create and configure an AWS account. I refer you to AWS documentation for information how to do this.</p><p>Once I created an account, I installed the <a href=https://eksctl.io/><code>eksctl</code></a> tool that makes easy to create a Kubernetes cluster on AWS.</p><p>Also you need to install the <a href=https://helm.sh/><code>helm</code></a> deployment tool and use it to actually install OpenWhisk. You can download the helm chart from GitHub and install OpenWhisk as follows:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>git clone https://github.com/apache/openwhisk-deploy-kube
cd openwhisk-deploy-kube/helm
</code></pre></div><p>Once everything is ready your can create a Kubernetes cluster and install OpenWhisk with just 3 commands:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>eksctl create cluster --name openwhisk
eksctl create nodegroup --cluster openwhisk --node-labels openwhisk-role=invoker
helm install --set whisk.ingress.type=LoadBalancer openwhisk ./openwhisk
</code></pre></div><p>The cluster creation will take a while. Once it is completed you will get your private OpenWhisk service running in AWS, and you can deploy your chess application to it.</p><p>You can use the <code>wsk</code> or <code>nim</code> CLIs to deploy to OpenWhisk. You have to retrieve the location of the Apache OpenWhisk entry point, and the authorization key and pass them to the CLI tool. The required commands using <code>nim</code> are:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>cd whisk-chess
APIHOST=$(kubectl  get svc | awk &#39;/openwhisk-nginx/ { print $4}&#39;)
AUTH=$(cat openwhisk/values.yaml |  awk &#39;/guest/ { print $2}&#39; | tr -d &#39;&#34;&#39;)
nim auth login --apihost http://$APIHOST --auth $AUTH
</code></pre></div><p>It is important to note that we configured an insecure setup because we are accessing OpenWhisk over the unencrypted HTTP protocol.</p><p>In a real world setup you will need additional steps to setup an HTTPS endpoint with a certificate. You will find relevant details in the <a href=https://github.com/apache/openwhisk-deploy-kuhttps://github.com/apache/openwhisk-deploy-ku>helm chart GitHub repository</a>.</p><p>Once you retrieved the API host and authentication key, you can deploy your chess app, and get the URL.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>nim action create chess chess.zip --web true --kind go:1.11
nim action get chess --url
</code></pre></div><p>I cannot provide a URL in this case as I a destroyed the cluster after testing, however, you can see the result in the image at the beginning of the paragraph.</p></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/advocate/>advocate</a></div><div class=clearit></div></div></div></div></main><footer>Â© Copyright <a href=https://www.linkedin.com/in/msciab>Michele SciabarrÃ </a> | Book <a href=https://www.oreilly.com/library/view/learning-apache-openwhisk/9781492046158/>Learning Apache OpenWhisk</a> published by <a href=https://www.oreilly.com/>O&rsquo;Reilly</a><div><b>Disclaimer</b>: opinions expressed are solely my own and do not express<br>the views or opinions of the <a href=https://www.apache.org>Apache Software Foundation</a>.</div></footer></body></html>